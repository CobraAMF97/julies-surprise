<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Quête du Serpent Sage</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Georgia', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            overflow: hidden;
        }
        #gameCanvas {
            background-color: #111;
            position: relative;
        }
        #scoreboard {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 24px;
            z-index: 10;
        }
        #errorMessage {
            color: white;
            font-size: 24px;
            text-align: center;
            display: none; /* Masqué par défaut */
        }
    </style>
</head>
<body>

<!-- Musique de fond -->
<audio id="background-music" autoplay loop>
    <source src="/mnt/data/Nathan Dawe x Bebe Rexha - Heart Still Beating (Official Visualiser).mp3" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>

<canvas id="gameCanvas"></canvas>
<div id="scoreboard">Score: <span id="score">0</span></div>
<div id="errorMessage">Cette page ne peut être ouverte que sur un appareil mobile.</div>

<script>
    function isMobileDevice() {
        return /Mobi|Android|iPhone|iPad|iPod/.test(navigator.userAgent);
    }

    if (!isMobileDevice()) {
        // Afficher le message d'erreur et masquer le canvas du jeu
        document.getElementById('gameCanvas').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'block';
    } else {
        // Introduction à l'histoire
        alert("Il était une fois, dans une forêt enchantée, un serpent sage qui gardait un secret précieux : le mot de passe d'un trésor caché. Mais ce mot de passe ne pouvait être révélé qu'à une âme courageuse qui réussirait une épreuve difficile. Guide le serpent et récolte les fruits magiques pour découvrir le mot de passe secret.");

        // Code du jeu Snake
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const boxSize = 20;
        let snake = [{x: boxSize * 5, y: boxSize * 5}];
        let direction = {x: boxSize, y: 0};
        let food = {x: boxSize * Math.floor(Math.random() * 15), y: boxSize * Math.floor(Math.random() * 15)};
        let gameInterval;
        let score = 0;
        const maxScore = 2001;  // Score à atteindre pour gagner

        canvas.width = boxSize * 20;
        canvas.height = boxSize * 20;

        function drawBox(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, boxSize, boxSize);
        }

        function drawSnake() {
            snake.forEach(segment => drawBox(segment.x, segment.y, 'green'));
        }

        function drawFood() {
            drawBox(food.x, food.y, 'red');
        }

        function moveSnake() {
            const newHead = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
            snake.unshift(newHead);

            if (newHead.x === food.x && newHead.y === food.y) {
                food = {x: boxSize * Math.floor(Math.random() * 15), y: boxSize * Math.floor(Math.random() * 15)};
                score += 100;  // Ajouter 100 points au score
                document.getElementById('score').innerText = score;

                // Affichage des messages de l'histoire
                showStoryMessage();

                // Vérification de la condition de victoire
                if (score >= maxScore) {
                    clearInterval(gameInterval);
                    alert("Félicitations, Julie ! Le serpent sait maintenant que tu es digne de connaître le mot de passe. Le voici : CAPDES3ANS. Utilise-le pour découvrir le trésor caché.");
                }
            } else {
                snake.pop();
            }
        }

        function checkCollision() {
            const head = snake[0];
            if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
                return true;
            }
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return true;
                }
            }
            return false;
        }

        function update() {
            moveSnake();
            if (checkCollision()) {
                clearInterval(gameInterval);
                alert('Game Over');
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawSnake();
            drawFood();
        }

        function gameLoop() {
            update();
            draw();
        }

        // Fonction pour afficher les messages de l'histoire en fonction du score
        function showStoryMessage() {
            if (score === 500) {
                alert("Le serpent commence à se sentir plus confiant. Tu es sur la bonne voie, mais le chemin est encore long...");
            } else if (score === 1000) {
                alert("Le serpent s'émerveille de ta ténacité. Il sait que tu es proche du secret, mais il faut encore plus d'efforts.");
            } else if (score === 1500) {
                alert("Le serpent est impressionné ! Très peu sont allés aussi loin. Le secret n'est plus qu'à portée de main...");
            }
        }

        // Lancer le jeu
        gameInterval = setInterval(gameLoop, 150);

        canvas.addEventListener('touchstart', (event) => {
            const touch = event.touches[0];
            const rect = canvas.getBoundingClientRect();
            const touchX = touch.clientX - rect.left;
            const touchY = touch.clientY - rect.top;

            const head = snake[0];
            if (Math.abs(touchX - head.x) > Math.abs(touchY - head.y)) {
                direction = {x: touchX > head.x ? boxSize : -boxSize, y: 0};
            } else {
                direction = {x: 0, y: touchY > head.y ? boxSize : -boxSize};
            }
        });
    }
</script>

</body>
</html>
